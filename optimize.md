# 系统优化与改进计划

## 一、功能层面的优化建议

### 1. 创作「流水线」与工具联动（P1）

- **故事流水线串联**  
  - 构建从「剧情大纲 → 故事正文 → 书名 → 宣传文案/诗歌」的完整创作流水线。  
  - 在各模块输出区域增加「用这个结果继续…」操作：
    - 剧情 → 一键带入故事生成页面。
    - 故事 → 一键带入书名生成工具。
    - 故事 → 一键带入诗歌生成工具作为灵感源。
    - 同人 → 一键转普通故事或生成续篇。

- **统一作品中心（跨工具）**  
  - 将 StoryStorage / PlotStorage 等历史记录能力抽象为统一「作品中心」。  
  - 跨工具查看：支持按类型（故事/大纲/诗歌/书名）、时间、语言、模型筛选。  
  - 提供「复制为新草稿」「设为模板」等操作。

### 2. 模板系统 & 引导增强（P1）

- **模板可配置化**  
  - 将 story-generate 里现有的 RANDOM_PROMPTS、PRESET_TEMPLATES 抽象为可配置数据源（JSON/CMS）。  
  - 通过配置新增主题/题材，而不需要改代码。  
  - 支持「用户收藏为个人模板」，在多工具间复用。

- **引导式表单 / Wizard 模式**  
  - 提供面向新手的分步引导：  
    - 第一步仅需填写「世界观 + 主角 + 冲突」，自动推导大部分高级选项。  
    - 高级选项折叠在「展开高级选项」中，减少初次使用时的心智负担。

### 3. 账号与云端作品管理（P2）

- 利用现有登录上下文（useAppContext、StorySaveDialog 等）扩展出云端「作品库」：
  - 提供作品列表页：分页 + 搜索 + 标签筛选。  
  - 第一阶段可先实现「最近生成的 20 条」视图。  
  - 后续扩展版本历史、版本对比能力。

### 4. 高级创作者功能（P2）

- **个人写作偏好 / 人物卡**  
  - 允许用户配置常驻设定：写作风格、常见世界观、主要角色档案。  
  - 在每次生成时自动拼接进 Prompt，减少重复输入。

- **AI 批改 / 润色模式**  
  - 对已有文本（粘贴或历史作品）提供：
    - 结构点评。  
    - 角色深度改写。  
    - 译文重写（保持文风，切换语言）。

---

## 二、性能与架构层面的优化建议

### 1. 前端性能（P0–P1）

- **大组件拆分 & 按需加载**  
  - 将 story-generate、plot-generate 等超大组件拆分为更小的 UI/逻辑单元：
    - AdvancedOptionsPanel。  
    - ModelSelector。  
    - OutputPanel。  
    - SaveStorySection 等。  
  - 对 ReactMarkdown、StorySaveDialog、PlotToStoryDialog 等非首屏关键组件使用动态导入，减小首包体积。

- **生产环境日志收敛**  
  - 当前前后端均有较多 console.log（参数、请求体、Cloudflare 回包等）。  
  - 抽象简单 logger 工具：
    - 按级别（debug/info/error）与环境控制输出。  
    - 开发环境保留详细调试日志，生产环境只保留必要信息。
   - 已实现：统一后端 logger，在生产环境中全局禁用 console.log/debug/info，仅保留 warn/error 输出。

- **流式解析协议统一**  
  - 目前前端解析类似 0:"..." 这种自定义格式。  
  - 建议统一为 SSE 或 JSONLines（每行 {"delta": "..."}）：
    - 降低解析复杂度与出错概率。  
    - 更方便切换或新增模型提供方。

### 2. 后端/API 性能与稳定性（P1）

- **第三方 API 封装层**  
  - 为对 GRSAI 的调用抽象一个 callLLM({ model, systemPrompt, userPrompt, stream }) 工具层：
    - 统一超时、重试策略。  
    - 统一错误结构解析与日志格式。  
    - 后续替换模型供应商或增加冗余时只需改这一层。

- **Turnstile 验证缓存/节流（按风控策略，已完成）**  
  - 对同一 IP + userId + 短时间内的多次生成，考虑短期缓存验证结果（例如 1–2 分钟）。  
  - 降低重复调用 Cloudflare 的时延，提高真实用户体验（需结合安全策略评估）。

---

## 三、用户使用便捷 & 体验优化

### 1. 智能默认值 & 表单体验（P0）

- **默认模型与选项（已完成）**  
  - 为 story-generate 等工具设置推荐模型默认值（如 standard），减少强制选择步骤。  
  - 高级选项（长度、视角、语气等）提供合理默认值，而不是纯 "none"。

- **统一快捷键（已完成）**  
  - Cmd/Ctrl + Enter：触发生成。  
  - Cmd/Ctrl + S：打开保存对话框（登录状态下）。  
  - 输出区聚焦时，按 G 返回输入区。  
  - 在按钮或页面底部标注简洁快捷键提示。

- **自动保存输入草稿（已完成）**  
  - 对 prompt 等输入内容进行本地自动保存：
    - 停止输入 N 秒或定时写入 localStorage。  
    - 页面刷新后自动恢复未提交草稿。  
  - 将这套逻辑抽象为可复用的 storage 工具，供多模块共享。

### 2. 历史与对比体验（P1）

- **历史浏览可视化**  
  - 在现有 Dropdown 的基础上，增加右侧「历史面板」抽屉：
    - 列表展示最近作品，支持搜索/筛选。  
    - 点击某一条即可加载到当前编辑器。  
  - 提供「多版本对比」：选择两条历史，在对话框里左右对照查看差异。

### 3. 文案 & 错误反馈（P0）

- **错误文案统一到 i18n**  
  - 将所有 toast.error / toast.success 文案统一放入多语言资源文件：
    - 文案结构：标题 + 简要原因 + 建议。  
    - 避免中英文混用和硬编码提示。

- **进度反馈统一化**  
  - 将 GenerationProgress 等进度展示抽象成统一组件：
    - 通过 props 配置文案、图标和 tips。  
    - 在故事/同人/大纲/诗歌等模块统一体验，减少重复实现。

### 4. 多语言体验统一（P1）

- **界面语言 vs 生成语言**  
  - 明确区分「界面语言（locale）」与「生成内容语言」：
    - 默认生成语言 = 界面语言。  
    - 用户可在每个工具中手动切换生成语言。  
  - 当生成语言与界面语言不一致时，在输出区顶部显示标签：
    - 例如「内容语言：English」。

---

## 四、实施优先级建议

- **P0（投入小、收益立竿见影）**  
  - 默认选中推荐模型与合理高级选项默认值。  
  - 统一快捷键（生成、保存）。  
  - 将错误文案完全迁移到 i18n。  
  - 生产环境关闭/收敛大部分调试级日志。

- **P1（体验提升明显）**  
  - 大组件拆分 + 动态导入重组件。  
  - 创作流水线：大纲 → 故事 → 书名 的串联。  
  - 统一作品中心 / 历史面板（先实现只读 + 加载）。

- **P2（中长期能力建设）**  
  - 云端作品库（账号体系下的作品管理）。  
  - 写作偏好/人物卡、AI 批改等高级创作能力。  
  - 更丰富的数据统计与创作分析能力。
